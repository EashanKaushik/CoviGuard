{% extends 'main.html' %}
{% load static %}
{% load get_value %}

{% block stylesheettwo %}
    <link rel="stylesheet" href="{% static 'css/circle/style_members.css' %}" />
{% endblock stylesheettwo %}


{% block content %}
<!-- intro -->
<section class="bg-light p-1">
    <div class="container my-5">
        <div class="row">
            <div class="col-sm-3">
                <img height="250" width="250" src="{{ circle_data.circle_id.group_image.url }}" class="img-fluid rounded-circle" alt="...">
            </div>
            <div class="col-sm-9">
                <h1 class="fw-bold text-uppercase text-secondary align-self-start">
                    {{circle_data.circle_id.circle_name}}
                </h1>
                <hr>
                <p class="text-muted d-block">Admin:
                    <spam class="text-dark fw-bold">{{circle_data.circle_id.admin_username.username}}</spam>
                </p>
                <p class="text-muted d-block">Number of Members:
                    <span class="text-dark fw-bold">{{circle_data.circle_id.no_of_users}}</span>
                </p>
                {% if is_admin %}
                    <p class="text-muted d-block">Pending Requests:
                        <spam class="text-muted fw-bold">{{circle_request}}</spam>
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<section>
    <div class="container bg-light my-5 p-3 col-lg-4">
        <h3 class="m-b-50 heading-line">Members
            {% comment %} <i class="bi bi-exclamation-square-fill text-danger"></i> {% endcomment %}
        </h3>
        {% for data in circle_user_data %}
            <div class="member-ui_dd-content">
                <div class="member-list {% if user_alert|hash:data.username.username %} member-list--alert {% else %} member-list--safe {% endif %} {% if data.is_admin %} member-list--admin {% else %} member-list--member {% endif %}">
                    <div class="member-list_content">
                        <div class="member-list_img"> 
                            <img src="{{ data.username.user_image.url }}" alt="user"> 
                        </div>
                        <div class="member-list_detail">
                            <h4>{{data.username.username}}</h4>
                            <a href="{% url 'login:settings' data.username.username 'profile' %}"><button type="button" class="btn btn-outline-warning">Profile</button></a>
                            {% comment %}
                            # TODO: Non compliance
                            # Alert: circle alert {% endcomment %}
                            {% comment %} {% define "btn-outline-danger" as action %} {% endcomment %}
                            {% comment %} {{ is_compliant[data.username.username] }} {% endcomment %}
                            <button type="button" class="btn {% if is_compliant|hash:data.username.username %} btn-outline-success {% else %} btn-outline-danger {% endif %}" data-bs-toggle="modal" data-bs-target="#{{ data.username.username }}">
                                <i class="bi bi-question-square-fill"></i>
                            </button>

                            <button type="button" class="btn {% if user_alert|hash:data.username.username %} btn-outline-danger {% else %} btn-outline-success {% endif %}" data-bs-toggle="modal" data-bs-target="#{{ data.username.username }}">
                                <i class="bi bi-exclamation-diamond-fill"></i>
                            </button>

                            </form>

                        </div>
                    </div>
                    

                    <div class="member-list_feature-btn">
                        {% if is_admin %}
                            {% if data.is_member %}
                                <button type="button" class="btn btn-outline-danger member-list" data-bs-toggle="modal" data-bs-target="#{{ data.username.username }}">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                                <!-- Modal -->
                                <div class="modal fade" id="{{ data.username.username }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-body">
                                                Are you sure you want to remove {{data.username.username}}?
                                            </div>
                                            <div class="modal-footer">
                                                <form action="" method="post">
                                                    {% csrf_token %}
                                                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                                                    <button class="btn btn-outline-danger" type="submit" name="remove_user" value="{{data.username.username}}">
                                                        Yes
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</section>


<section class="bg-light">
    <div class="container">
        <div>
            {% include 'user-search.html' %}
        </div>
    </div>
</section>

{% endblock content %}